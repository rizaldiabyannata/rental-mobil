// Prisma schema for rental-mobil app
// Schema berdasarkan todo list backend

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// Musim tarif dihapus (tidak digunakan)

// üöó Manajemen Armada (Mobil)
model Car {
    id             String   @id @default(uuid())
    slug           String?  @unique // SEO-friendly unique slug
    name           String   @default("Unnamed") // Nama mobil
    description    String? // Deskripsi
    startingPrice  Int      @default(0) // Harga mulai (dalam rupiah)
    capacity       Int      @default(4) // Kapasitas penumpang
    transmission   String   @default("Manual") // Transmisi (Manual/Automatic)
    fuelType       String   @default("Bensin") // Jenis bahan bakar
    available      Boolean  @default(true)
    specifications Json? // Spesifikasi lengkap
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt

    // Relations
    images        CarImage[]
    tariffItems   TariffItem[]
    featureBlocks CarFeature[]
}

// Galeri foto mobil
model CarImage {
    id        String   @id @default(uuid())
    carId     String
    imageUrl  String
    alt       String?
    order     Int      @default(0) // untuk urutan slider
    createdAt DateTime @default(now())

    car Car @relation(fields: [carId], references: [id], onDelete: Cascade)
}

// Fitur unggulan per mobil (dengan icon, title, description)
model CarFeature {
    id          String   @id @default(uuid())
    carId       String
    icon        String // nama icon atau URL
    title       String
    description String
    order       Int      @default(0)
    createdAt   DateTime @default(now())

    car Car @relation(fields: [carId], references: [id], onDelete: Cascade)

    @@index([carId])
    @@index([order])
}

// üéØ Manajemen Paket Tour
model TourPackage {
    id            String   @id @default(uuid())
    slug          String   @unique // SEO-friendly unique slug
    name          String
    description   String
    duration      String // e.g., "3 Hari 2 Malam"
    inclusions    String[] // List of what's included
    galleryImages String[] // List of image URLs
    showHotels    Boolean  @default(true) // Option to show/hide hotel names
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    hotelTiers HotelTier[]

    @@index([slug])
}

// Tingkatan hotel untuk setiap paket (e.g., Bintang 2, Bintang 3)
model HotelTier {
    id            String @id @default(uuid())
    tourPackageId String
    name          String // e.g., "Hotel Bintang 2", "Hotel Bintang 3"
    hotels        String[] // List of hotel names in this tier
    order         Int    @default(0)

    tourPackage TourPackage @relation(fields: [tourPackageId], references: [id], onDelete: Cascade)
    priceTiers  PriceTier[]

    @@index([tourPackageId])
}

// Tingkatan harga berdasarkan jumlah orang (pax)
model PriceTier {
    id          String @id @default(uuid())
    hotelTierId String
    paxRange    String // e.g., "2-3 PAX"
    price       Int    // Harga per pax dalam IDR

    hotelTier HotelTier @relation(fields: [hotelTierId], references: [id], onDelete: Cascade)

    @@index([hotelTierId])
}

// ‚ùì Manajemen FAQ
model FAQ {
    id        String   @id @default(uuid())
    question  String // Pertanyaan
    answer    String // Jawaban
    order     Int      @default(0) // untuk urutan tampil
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

// üìã Manajemen Syarat & Ketentuan
model TermsAndConditions {
    id        String   @id @default(uuid())
    category  String // Kategori (Umum, Sewa Mobil, Pembayaran, dll.)
    title     String // Judul poin syarat & ketentuan
    content   String // Isi detail syarat & ketentuan
    order     Int      @default(0) // untuk urutan tampil
    isActive  Boolean  @default(true) // status aktif/nonaktif
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([category])
    @@index([isActive])
}

// ü§ù Manajemen Mitra
model Partner {
    id        String   @id @default(uuid())
    name      String // Nama mitra
    logoUrl   String // File gambar logo
    order     Int      @default(0) // untuk urutan tampil
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

// Tariff Penyewaan Umum (bukan per-mobil)
model TariffCategory {
    id          String   @id @default(uuid())
    name        String
    description String?
    order       Int      @default(0)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    items TariffItem[]

    @@index([order])
}

model TariffItem {
    id          String   @id @default(uuid())
    categoryId  String
    carId       String? // optional per-armada target
    name        String // contoh: "Dengan Driver", "Driver + BBM", "Tujuan Mataram"
    price       Int // dalam rupiah
    serviceType String? // e.g., "12-hour rental", "Airport transfer"
    packageType String? // e.g., "With Driver", "Driver + Fuel"
    order       Int      @default(0)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    category TariffCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
    car      Car?           @relation(fields: [carId], references: [id], onDelete: Cascade)

    @@index([categoryId])
    @@index([carId])
    @@index([order])
    @@index([serviceType])
    @@index([packageType])
}

// User untuk admin saja (saat ini)
model User {
    id                    String                 @id @default(uuid())
    email                 String                 @unique
    name                  String?
    role                  String                 @default("ADMIN") // ADMIN (saat ini hanya admin)
    // Hashed password for authentication (bcrypt hash)
    password              String                 @default("")
    createdAt             DateTime               @default(now())
    updatedAt             DateTime               @updatedAt
    // bookings  Booking[]
    passwordResetRequests PasswordResetRequest[]
}

// üîê Password Reset (OTP)
model PasswordResetRequest {
    id        String   @id @default(uuid())
    userId    String
    otp       String
    expiresAt DateTime
    verified  Boolean  @default(false)
    consumed  Boolean  @default(false)
    attempts  Int      @default(0)
    createdAt DateTime @default(now())

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
    @@index([expiresAt])
}